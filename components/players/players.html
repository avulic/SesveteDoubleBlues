<template>

    <link rel="stylesheet" href="./css/style.css">

    <link rel="stylesheet"
        href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">

    <link rel="stylesheet"
        href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />

    <div id="field-container" class="container-fluid">
        <div id="field" class="field">
            <div id="team">
            </div>
            <div id="field-texture-container">
                <div id="grass"></div>
                <div id="sides" class="field-texture"></div>
                <div id="goal-away" class="field-texture"></div>
                <div id="poles-away" class="field-texture holder">
                    <div class="cylinder-left">
                        <div class="face" style="--index: 0;"></div>
                        <div class="face" style="--index: 1;"></div>
                        <div class="face" style="--index: 2;"></div>
                        <div class="face" style="--index: 3;"></div>
                        <div class="face" style="--index: 4;"></div>
                        <div class="face" style="--index: 5;"></div>
                        <div class="face" style="--index: 6;"></div>
                        <div class="face" style="--index: 7;"></div>
                        <div class="face" style="--index: 8;"></div>
                        <div class="face" style="--index: 9;"></div>
                        <div class="face-bottom" style=""></div>

                    </div>
                    <div class="cylinder-right">
                        <div class="face" style="--index: 0;"></div>
                        <div class="face" style="--index: 1;"></div>
                        <div class="face" style="--index: 2;"></div>
                        <div class="face" style="--index: 3;"></div>
                        <div class="face" style="--index: 4;"></div>
                        <div class="face" style="--index: 5;"></div>
                        <div class="face" style="--index: 6;"></div>
                        <div class="face" style="--index: 7;"></div>
                        <div class="face" style="--index: 8;"></div>
                        <div class="face" style="--index: 9;"></div>
                        <div class="face-bottom" style=""></div>

                    </div>

                    <div class="cylinder-left behind">
                        <div class="face" style="--index: 0;"></div>
                        <div class="face" style="--index: 1;"></div>
                        <div class="face" style="--index: 2;"></div>
                        <div class="face" style="--index: 3;"></div>
                        <div class="face" style="--index: 4;"></div>
                        <div class="face" style="--index: 5;"></div>
                        <div class="face" style="--index: 6;"></div>
                        <div class="face" style="--index: 7;"></div>
                        <div class="face" style="--index: 8;"></div>
                        <div class="face" style="--index: 9;"></div>
                        <div class="face-bottom" style=""></div>

                    </div>
                    <div class="cylinder-right behind">
                        <div class="face" style="--index: 0;"></div>
                        <div class="face" style="--index: 1;"></div>
                        <div class="face" style="--index: 2;"></div>
                        <div class="face" style="--index: 3;"></div>
                        <div class="face" style="--index: 4;"></div>
                        <div class="face" style="--index: 5;"></div>
                        <div class="face" style="--index: 6;"></div>
                        <div class="face" style="--index: 7;"></div>
                        <div class="face" style="--index: 8;"></div>
                        <div class="face" style="--index: 9;"></div>
                        <div class="face-bottom" style=""></div>
                    </div>
                </div>
                <div id="goal-penalty-away" class="field-texture"></div>
                <!-- <div id="arc-away" class="field-texture"></div> -->
                <div id="center" class="field-texture"></div>
                <div id="center-line" class="field-texture"></div>
                <!-- <div id="arc-home" class="field-texture"></div> -->
                <div id="goal-penalty-home" class="field-texture"></div>
                <div id="poles-home" class="field-texture holder">
                    <div class="cylinder-left">
                        <div class="face" style="--index: 0;"></div>
                        <div class="face" style="--index: 1;"></div>
                        <div class="face" style="--index: 2;"></div>
                        <div class="face" style="--index: 3;"></div>
                        <div class="face" style="--index: 4;"></div>
                        <div class="face" style="--index: 5;"></div>
                        <div class="face" style="--index: 6;"></div>
                        <div class="face" style="--index: 7;"></div>
                        <div class="face" style="--index: 8;"></div>
                        <div class="face" style="--index: 9;"></div>
                        <div class="face-bottom" style=""></div>

                    </div>
                    <div class="cylinder-right">
                        <div class="face" style="--index: 0;"></div>
                        <div class="face" style="--index: 1;"></div>
                        <div class="face" style="--index: 2;"></div>
                        <div class="face" style="--index: 3;"></div>
                        <div class="face" style="--index: 4;"></div>
                        <div class="face" style="--index: 5;"></div>
                        <div class="face" style="--index: 6;"></div>
                        <div class="face" style="--index: 7;"></div>
                        <div class="face" style="--index: 8;"></div>
                        <div class="face" style="--index: 9;"></div>
                        <div class="face-bottom" style=""></div>
                    </div>

                    <div class="cylinder-left behind">
                        <div class="face" style="--index: 0;"></div>
                        <div class="face" style="--index: 1;"></div>
                        <div class="face" style="--index: 2;"></div>
                        <div class="face" style="--index: 3;"></div>
                        <div class="face" style="--index: 4;"></div>
                        <div class="face" style="--index: 5;"></div>
                        <div class="face" style="--index: 6;"></div>
                        <div class="face" style="--index: 7;"></div>
                        <div class="face" style="--index: 8;"></div>
                        <div class="face" style="--index: 9;"></div>
                        <div class="face-bottom" style=""></div>

                    </div>
                    <div class="cylinder-right behind">
                        <div class="face" style="--index: 0;"></div>
                        <div class="face" style="--index: 1;"></div>
                        <div class="face" style="--index: 2;"></div>
                        <div class="face" style="--index: 3;"></div>
                        <div class="face" style="--index: 4;"></div>
                        <div class="face" style="--index: 5;"></div>
                        <div class="face" style="--index: 6;"></div>
                        <div class="face" style="--index: 7;"></div>
                        <div class="face" style="--index: 8;"></div>
                        <div class="face" style="--index: 9;"></div>
                        <div class="face-bottom" style=""></div>
                    </div>
                </div>
                <div id="goal-home" class="field-texture"></div>
            </div>
        </div>
    </div>

    <script>
        ASSET_URL = './images/players/profil/';
        FUT_CARD_ASSET_URL = './images/players/fut/';
        PLAYER_ASSET_URL = './images/players/crop/';

        $stage = null;
        $world = null;
        $terrain = null;


        var root = $(this.document.querySelector("players-component").shadowRoot);

        var $field = root.find('#field');
        var $team = root.find('#team');
        var $cards = root.find('#player-card-container');


        $teamListHome = null;
        $players = null;
        $playersHome = null;
        $playersAway = null;
        $switchBtn = null;
        $loadBtn = null;
        $closeBtn = null;
        $heading = null;
        $subHeading = null;
        $loading = null;
        $switcher = null;

        player = null;
        card = null;
        chart = null;
        team = null;
        field = null;
        playerDescription = null;
        futCardContainer = null;


        data = {
            players: {
                home: [
                    {
                        name: 'Duksi',
                        asset: 'Duksi',
                        origin: 'Peru',
                        height: '1.84m',
                        shirt: '14',
                        pos: 'FB',
                        dob: '36',
                        goals: 1,
                        games: 16,
                        position: { x: [-31, -34], y: -210, z: 42, left: 50 }
                    },
                    {
                        name: 'Dinko',
                        asset: 'Dinko',
                        origin: 'Peru',
                        height: '1.84m',
                        shirt: '14',
                        pos: 'HB',
                        dob: '36',
                        goals: 1,
                        games: 16,
                        position: { x: [-21, -27], y: -111, z: 42, left: 26 }
                    },
                    {
                        name: 'Neno',
                        asset: 'Neno',
                        origin: 'Peru',
                        height: '1.84m',
                        shirt: '14',
                        pos: 'HB',
                        dob: '36',
                        goals: 1,
                        games: 16,
                        position: { x: [-22, -34], y: -111, z: 40, left: 72 }
                    },
                    {
                        name: 'Mole',
                        asset: 'Mole',
                        origin: 'Peru',
                        height: '1.84m',
                        shirt: '14',
                        pos: 'R',
                        dob: '36',
                        goals: 1,
                        games: 16,
                        position: { x: [-21, -27], y: 51, z: 42, left: 63 }
                    },
                    {
                        name: 'Vele',
                        asset: 'Vele',
                        origin: 'Peru',
                        height: '1.84m',
                        shirt: '14',
                        pos: 'R',
                        dob: '36',
                        goals: 1,
                        games: 16,
                        position: { x: [-21, -27], y: 128, z: 42, left: 49 }
                    },
                    {
                        name: 'Piksi',
                        asset: 'Piksi',
                        origin: 'Peru',
                        height: '1.84m',
                        shirt: '14',
                        pos: 'R',
                        dob: '36',
                        goals: 1,
                        games: 16,
                        position: { x: [-21, -27], y: 51, z: 42, left: 36 }
                    },
                    {
                        name: 'Kolja',
                        asset: 'Kolja',
                        origin: 'Peru',
                        height: '1.84m',
                        shirt: '14',
                        pos: 'HF',
                        dob: '36',
                        goals: 1,
                        games: 16,
                        position: { x: [-21, -27], y: 267, z: 42, left: 70 }
                    },
                    {
                        name: 'Zgela',
                        asset: 'Zgela',
                        origin: 'Peru',
                        height: '1.84m',
                        shirt: '14',
                        pos: 'HF',
                        dob: '36',
                        goals: 1,
                        games: 16,
                        position: { x: [-21, -27], y: 265, z: 42, left: 29 }
                    },
                    {
                        name: 'Mac',
                        asset: 'Mac',
                        origin: 'Peru',
                        height: '1.84m',
                        shirt: '14',
                        pos: 'FF',
                        dob: '36',
                        goals: 1,
                        games: 16,
                        position: { x: [-31, -34], y: 337, z: 42, left: 50 }
                    },

                ],
                away: [
                    {
                        name: 'Pizarro', asset: 'bm-pizarro.jpg', origin: 'Peru', height: '1.84m', shirt: '14', pos: 'Forward', dob: '36', goals: 1, games: 16, x: 110, y: -190
                    },
                    {
                        name: 'Pizarro', asset: 'bm-pizarro.jpg', origin: 'Peru', height: '1.84m', shirt: '14', pos: 'Forward', dob: '36', goals: 1, games: 16, x: 110, y: -190
                    },
                    {
                        name: 'Pizarro', asset: 'bm-pizarro.jpg', origin: 'Peru', height: '1.84m', shirt: '14', pos: 'Forward', dob: '36', goals: 1, games: 16, x: 110, y: -190
                    },
                    {
                        name: 'Pizarro', asset: 'bm-pizarro.jpg', origin: 'Peru', height: '1.84m', shirt: '14', pos: 'Forward', dob: '36', goals: 1, games: 16, x: 110, y: -190
                    },
                    {
                        name: 'Pizarro', asset: 'bm-pizarro.jpg', origin: 'Peru', height: '1.84m', shirt: '14', pos: 'Forward', dob: '36', goals: 1, games: 16, x: 110, y: -190
                    },

                ],
            }
        };

        state = {
            home: true,
            playersArranged: false,
            disabHover: false,
            swapSides: function () {
                if (this.home) this.home = false;
                else this.home = true;
            },
            curSide: function () {
                return this.home ? 'home' : 'away';
            },
        };

        pos = {
            world: {
                baseX: 0,
                baseY: 0,
                baseZ: -200,
            },
            def: {
                goalie: [0, -50],
            },
        };

        dom = {
            preloadImages: function (preload) {
                const promises = [];
                let i = 0;
                while (i < preload.length) {
                    ((url, promise) => {
                        const img = new Image();
                        img.onload = () => promise.resolve();
                        img.src = url;
                    })(preload[i], (promises[i] = $.Deferred()));
                    i++;
                }
                $.when.apply($, promises).done(() => {
                    scenes.endLoading();
                    scenes.loadIn(1600);
                });
            },
            populateCard: function ($el, data) {
                $el.append(
                    `<h3>${data.name}</h3>` +
                    '<ul class="player__card__list"><li><span>DOB</span><br/>' +
                    `${data.dob} yr</li><li><span>Height</span><br/>${data.height}</li>` +
                    `<li><span>Origin</span><br/>${data.origin}</li></ul>` +
                    '<ul class="player__card__list player__card__list--last">' +
                    `<li><span>Games</span><br/>${data.games}</li>` +
                    `<li><span>Goals</span><br/>${data.goals}</li></ul>`
                );
            },
            displayNone: function ($el) {
                $el.css('display', 'none');
            },
        };

        events = {
            attachAll: function () {
                $switchBtn.on('click', (e) => {
                    e.preventDefault();
                    const $el = $(this);
                    if ($el.hasClass('disabled')) return;
                    scenes.switchSides();
                    $switchBtn.removeClass('disabled');
                    $el.addClass('disabled');
                });

                $loadBtn.on('click', (e) => {
                    e.preventDefault();
                    scenes.loadIn();
                });

                $players.on('click', (e) => {
                    e.preventDefault();
                    const $el = $(this);
                    if ($('.active').length) return false;
                    $el.addClass('active');
                    scenes.focusPlayer($el);
                    setTimeout(() => events.attachClose(), 1);
                });
            },
            attachClose: function () {
                $stage.one('click', (e) => {
                    e.preventDefault();
                    scenes.unfocusPlayer();
                });
            },
        };

        scenes = {
            preLoad: function () {
                $teamListHome.velocity({ opacity: 0 }, 0);
                $players.velocity({ opacity: 0 }, 0);
                $loadBtn.velocity({ opacity: 0 }, 0);
                $switcher.velocity({ opacity: 0 }, 0);
                $heading.velocity({ opacity: 0 }, 0);
                $subHeading.velocity({ opacity: 0 }, 0);
                $playersAway.css('display', 'none');
                $world.velocity({ opacity: 0, translateZ: -200, translateY: -60 }, 0);
                $('main').velocity({ opacity: 1 }, 0);
            },
            loadIn: function (delay = 0) {
                $world.velocity({ opacity: 1, translateY: 0, translateZ: -200 }, { duration: 1000, delay: delay, easing: 'spring' });
                anim.fadeInDir($heading, 300, delay + 600, 0, 30);
                anim.fadeInDir($subHeading, 300, delay + 800, 0, 30);
                anim.fadeInDir($teamListHome, 300, delay + 800, 0, 30);
                anim.fadeInDir($switcher, 300, delay + 900, 0, 30);
                delay += 1200;
                const delayInc = 30;
                anim.dropPlayers($playersHome, delay, delayInc);
            },
            startLoading: function () {
                anim.fadeInDir($loading, 300, 0, 0, -20);
                const images = [];
                for (const key in data.players.home, data.players.away) {
                    images.push(ASSET_URL + val.asset);
                }
                dom.preloadImages(images);
            },
            endLoading: function () {
                anim.fadeOutDir($loading, 300, 1000, 0, -20);
            },

            focusPlayer: function ($el) {
                const data = $el.data();
                let shiftY = data.y;
                if (shiftY > 0) shiftY = data.y / 2;

                $(`.js-player[data-side="${state.curSide()}"]`)
                    .not('.active')
                    .each(function () {
                        const $unfocus = $(this);
                        anim.fadeOutDir($unfocus, 300, 0, 0, 0, 0, null, 0.2);
                    });

                $world.velocity(
                    {
                        translateX: pos.world.baseX - data.x,
                        translateY: pos.world.baseY,
                        translateZ: pos.world.baseZ - shiftY, // Z is the Y axis on the field
                    },
                    600
                );

                $terrain.velocity({ opacity: 0.66 }, 600);
                this.showPlayerCard($el, 600, 600);
            },
            unfocusPlayer: function () {
                const $el = $('.js-player.active');
                const data = $el.data();
                anim.fadeInDir($(`.js-player[data-side="${state.curSide()}"]`).not('.active'), 300, 300, 0, 0, 0, null, 0.2);
                $el.removeClass('active');
                $world.velocity(
                    {
                        translateX: pos.world.baseX,
                        translateY: pos.world.baseY,
                        translateZ: pos.world.baseZ, // Z is the Y axis on the field
                    },
                    600
                );

                $terrain.velocity({ opacity: 1 }, 600);
                this.hidePlayerCard($el, 600, 600);
            },
            hidePlayerCard: function ($el, dur, delay) {
                const $card = $el.find('.player__card');
                const $image = $el.find('.player__img');
                $image.velocity({ translateY: 0 }, 300);
                anim.fadeInDir($el.find('.player__label'), 200, delay);
                anim.fadeOutDir($card, 300, 0, 0, -100);
            },
            showPlayerCard: function ($el, dur, delay) {
                const $card = $el.find('.player__card');
                const $image = $el.find('.player__img');
                $image.velocity({ translateY: '-=150px' }, 300);
                anim.fadeOutDir($el.find('.player__label'), 200, delay);
                anim.fadeInDir($card, 300, 200, 0, 100);
            },
            switchSides: function () {
                let delay = 0;
                const delayInc = 20;
                const $old = $playersHome;
                const $new = $playersAway;
                if (!state.home) {
                    $old = $playersAway;
                    $new = $playersHome;
                }
                state.swapSides();
                $old.each(function () {
                    const $el = $(this);
                    anim.fadeOutDir($el, 200, delay, 0, -60, 0);
                    anim.fadeOutDir($el.find('.player__label'), 200, delay + 700);
                    delay += delayInc;
                });
                $terrain.velocity({ rotateY: '+=180deg' }, { delay: 150, duration: 1200 });
                anim.dropPlayers($new, 1500, 30);
            },
        };

        anim = {
            fadeInDir: function ($el, dur, delay, deltaX = 0, deltaY = 0, deltaZ = 0, easing = null, opacity = 0) {
                $el.css('display', 'block');
                $el.velocity(
                    {
                        translateX: `-=${deltaX}`,
                        translateY: `-=${deltaY}`,
                        translateZ: `-=${deltaZ}`,
                    },
                    0
                );

                $el.velocity(
                    {
                        opacity: 1,
                        translateX: `+=${deltaX}`,
                        translateY: `+=${deltaY}`,
                        translateZ: `+=${deltaZ}`,
                    },
                    {
                        easing: easing,
                        delay: delay,
                        duration: dur,
                    }
                );
            },
            fadeOutDir: function ($el, dur, delay, deltaX = 0, deltaY = 0, deltaZ = 0, easing = null, opacity = 0) {
                let display = 'none';
                if (opacity) {
                    display = 'block';
                }
                $el.velocity(
                    {
                        opacity: opacity,
                        translateX: `+=${deltaX}`,
                        translateY: `+=${deltaY}`,
                        translateZ: `+=${deltaZ}`,
                    },
                    {
                        easing: easing,
                        delay: delay,
                        duration: dur,
                    }
                )
                    .velocity(
                        {
                            opacity: opacity,
                            translateX: `-=${deltaX}`,
                            translateY: `-=${deltaY}`,
                            translateZ: `-=${deltaZ}`,
                        },
                        {
                            duration: 0,
                            display: display,
                        }
                    );
            },
            dropPlayers: function ($els, delay, delayInc) {
                $els.each(function () {
                    const $el = $(this);
                    $el.css({
                        display: 'block',
                        opacity: 0,
                    });
                    anim.fadeInDir($el, 800, delay, 0, 50, 0, 'spring');
                    anim.fadeInDir($el.find('.player__label'), 200, delay + 250);
                    delay += delayInc;
                });
            },
        };



        function arrangePlayers() {
            const playersContainers = root.find('.player-container').get();
            playersContainers.forEach(function (container) {
                var player = container.childNodes[0]
                anime({
                    targets: player.childNodes[0],
                    opacity: 1,
                    duration: 50,
                });

                const [[x1, x2], y, z, left] = [
                    player.attributes['data-x'].value.split(','),
                    player.attributes['data-y'].value,
                    player.attributes['data-z'].value,
                    player.attributes['data-left'].value
                ]

                anime({
                    targets: player,
                    translateX: (x1, x2),
                    translateY: y,
                    translateZ: z,
                    rotateX: -90,
                    duration: 4000,
                    delay: 1000
                });

                $(player).css('left', left + '%');
                //root.find('.player.FF .circle').width(55);
                //var element = root.find('.player.FF')[0];
                //var width = element.offsetWidth;
            });
            state.playersArranged = true;
        }

        function addPlayers(side) {
            for (const key in data.players[side]) {
                const playerData = data.players[side][key];
                playerData.side = side;
                const $container = $(`<div class="player-container"></div>`);

                $team.append(makePlayer(playerData, $container));
                $team.append(addPlayerDescription(playerData, $container));
            }
            addCanvas();
            $players = root.find('.player');
            $playersHome = $('.player[data-side="home"]');
            $playersAway = $('.player[data-side="away"]');
        }

        function makePlayer(data, container) {
            const $player = $(`<div class="player ${data.pos}" data-x="${data.position.x}" data-y="${data.position.y}" data-z="${data.position.z}" data-left="${data.position.left}"></div>`);
            const $el = $(`<div class="circle"></div>`);
            $el.append(`<img src="${ASSET_URL}${data.asset}.jpg" height="60" width="60">`);
            $player.append($el);
            container.append($player);
            return container;
        }

        function addCard(element, container) {
            const card = $(`<div id="fut-card-container" class="${element.name}"></div>`);
            //card.css('display', 'none');

            const card_image_container = $(`<div id="fut-card"></div>`);
            const card_image = $(`<img src="${FUT_CARD_ASSET_URL}Empty.png" width="200" height="250">`);
            const cardName = $(`<span id="fut-card-name" class="">${element.name}</span>`);
            const cardValue = $(`<span id="fut-card-value" class="">94</span>`);
            const cardPosition = $(`<span id="fut-card-position" class="">Ruckman</span>`);

            card_image_container.append(card_image);
            card_image_container.append(cardName);
            card_image_container.append(cardValue);
            card_image_container.append(cardPosition);

            const card_player_image = $(`<div id="fut-card-player"><img src="${PLAYER_ASSET_URL}Jure_crop.png" width="250" height="300"></div>`);

            card.append(card_image_container);
            card.append(card_player_image);
            container.append(card);
            return container;
        }

        function fadeOut(element) {
            anime({
                targets: element,
                // translateX: `-=${deltaX}`,
                // translateY: `-=${deltaY}`,
                // translateZ: `-=${deltaZ}`,
                opacity: [1, 0.3],
                duration: 3000,
            });
        }

        function fadeIn(element) {
            anime({
                targets: element,
                // translateX: `+=${deltaX}`,
                // translateY: `+=${deltaY}`,
                // translateZ: `+=${deltaZ}`,
                opacity: 1,
                duration: 2000
            });
        }

        function animateCard(card) {
            var card_img = $(card).children()[0]
            var card_player_img = $(card).children()[1]

            // anime({
            //     targets: card,
            //     rotateX: 15,
            //     rotateY: 18,
            //     duration: 1000,
            //     easing: 'linear'
            // });

            // anime({
            //     targets: card_player_img,
            //     translateX: -75,
            //     translateY: 43,
            //     translateZ: 119,
            //     opacity: 1,
            //     duration: 1000,
            //     easing: 'linear',
            // });

            // anime({
            //     targets: $(card_player_img).children()[0],
            //     rotateX: -90,
            //     rotateY: 9,
            //     duration: 1000,
            //     easing: 'linear'
            // });

        }

        function showDescription(description) {
            futCardContainer = $(description).find("#fut-card-container");
            futPlayerContainer = $(description).find("#player-card-container");
            playerChartContainer = $(description).find("#canvasContainer");

            description.attr('id', 'player-description-container');
            description.css('visibility', 'visible');

            $(futPlayerContainer).show();

            animateCard(futPlayerContainer);
            showGraph(playerChartContainer);
        }

        function hideField(fieldTexture, field) {
            fieldTexture.addClass('field-texture-hidden');
            field.addClass('field-hidden');
        }

        function showField(fieldTexture) {
            fieldTexture.removeClass('field-texture-hidden');
            field.removeClass('field-hidden');
        }

        function hidePlayers(team) {
            team.addClass('player-hidden');
        }

        function showPlayers(team) {
            team.removeClass('player-hidden');
        }

        function addPlayerDescription(playerData, container) {
            var playerDescriptionContainer = $("<div>", {
                id: "player-description-container",
                class: "d-flex flex-column",
            }).appendTo(container);

            var flexRow = $("<div>", {
                class: "d-flex flex-row justify-content-center",
                style: "transform-style: preserve-3d",
            }).appendTo(playerDescriptionContainer);

            var playerCardContainer = $("<div>", {
                id: "player-card-container",
                css: {
                    width: "276px",
                    height: "100px",
                },
            }).appendTo(flexRow);

            addCard(playerData, playerCardContainer);

            var canvasContainer = $("<div>", {
                id: "canvasContainer",
                width: "225",
                height: "225",
            }).appendTo(flexRow);

            addCanvas(canvasContainer);

            var playerDescription = $("<div>", {
                id: "player-description",
                style: "transform-style: preserve-3d;font-size: small; "
            }).appendTo(playerDescriptionContainer);

            //var paragraph = $("<p>").text("Your description goes here.").appendTo(playerDescription);
            playerDescription = null;
            return container;
        }

        var myChart;

        function showGraph(cartContainer) {
            values = [2, 7, 10, 5, 8, 3, 2];
            labels = ["Kick", "Pass", "Mark", "Contest Mark", "Jump", "Sprint", "Tackle"];
            chart = $(cartContainer).children()[0];
            if (myChart) {
                myChart.destroy();
            }

            var data = {
                labels: labels,
                datasets: [{
                    label: "Skills",
                    data: values,
                    backgroundColor: 'rgba(75, 192, 192, 0.3)', // Fill color
                    borderColor: 'rgba(75, 192, 192, 1)', // Border color (white)
                    borderWidth: 2
                }]
            };

            myChart = new Chart(
                chart, {
                type: 'radar',
                data: data,
                options: {
                    scales: {
                        r: {
                            pointLabels: {
                                font: {
                                    size: 15
                                },
                                color: 'rgba(255, 255, 255, 1)'
                            },
                            grid: {
                                display: true,
                                color: 'rgba(255, 255, 255, 1)',
                                font: {
                                    size: 2
                                },
                            },
                            ticks: {
                                display: false, // Hide scale labels
                                beginAtZero: true,
                                max: 10,
                            }
                        }
                    }, plugins: {
                        legend: {
                            display: false
                        }
                    }
                }

            });
        }

        function preLoadCards() {
            const ASSET_URL = FUT_CARD_ASSET_URL; // Change this to the base URL of your image assets
            const images = [];

            // Replace this loop with your actual data
            for (const key in data.players.home) {
                if (data.players.home.hasOwnProperty(key)) {
                    const asset = data.players.home[key].asset;
                    images.push(ASSET_URL + asset);
                }
            }

            const promises = images.map((url) => {
                return new Promise((resolve) => {
                    const img = new Image();
                    img.onload = resolve;
                    img.src = url;
                });
            });

            Promise.all(promises)
                .then(() => {
                    // All images have been preloaded

                })
                .catch((error) => {
                    // Handle errors, such as failed image loading
                    console.error("Error preloading images:", error);
                });
        }

        function hideDescription(description) {
            $(description).css('visibility', 'hidden');
        }

        function addCanvas(canvasContainer) {
            var canvas = $("<canvas>", {
                id: "chartRadar",
                width: "225",
                height: "225",
            }).appendTo(canvasContainer);
        }

        function resetParameters(playerDescription) {
            futCardContainer = $(playerDescription).find("#fut-card-container");

            $(futCardContainer).find("#fut-card").attr("style", "transform: none")
            $($(futCardContainer).find("#fut-card").children()[0]).attr("style", "transform: none")
            $(futCardContainer).find("#fut-card-player").attr("style", "transform: none")
            $($(futCardContainer).find("#fut-card-player").children()[0]).attr("style", "transform: none")
        }



        root.find("#field-container").ready(function () {
            if (!state.playersArranged) {
                arrangePlayers();
            }
        })

        root.find("#field-container").click(function (event) {
            field = root.find("#field");
            team = root.find('#team .player');
            fieldTexture = $(root.find("#field-texture-container")).children();

            var clickedPlayer = event.target.closest('.player-container');

            if (playerDescription && $(playerDescription).css('visibility') === 'visible') {
                hideDescription(playerDescription);
                resetParameters(playerDescription);
                showField(fieldTexture, field);
                showPlayers(team);
            } else if (clickedPlayer) {
                playerDescription = $(clickedPlayer).find("#player-description-container");

                futCardContainer = $(playerDescription).find("#fut-card-container");
                hideField(fieldTexture, field);
                hidePlayers(team);
                showDescription(playerDescription);
            }
        });


        addPlayers('home');

    </script>
</template>